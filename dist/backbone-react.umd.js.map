{"version":3,"file":"backbone-react.umd.js","sources":["../src/utils.ts","../src/backbone-view.tsx","../src/react-view.tsx","../src/use-model.ts"],"sourcesContent":["export function pick<TObject, TKey extends keyof TObject>(\n  object: TObject,\n  keys: TKey[]\n): Pick<TObject, TKey> {\n  const picked: Partial<TObject> = {};\n  for (const key of Object.keys(object)) {\n    if (keys.includes(key as TKey)) {\n      (picked as any)[key] = (object as any)[key];\n    }\n  }\n\n  return picked as Pick<TObject, TKey>;\n}\n\nexport function isFunction(value: any): boolean {\n  return (\n    !!value && Object.prototype.toString.call(value) === '[object Function]'\n  );\n}\n","import React, {\n  memo,\n  forwardRef,\n  useRef,\n  useEffect,\n  Ref,\n  RefObject\n} from 'react';\nimport * as Backbone from 'backbone';\nimport { isFunction } from './utils';\n\ntype RefFunction<TValue> = (value: TValue | null) => void;\n\n// TODO Better typing here\ntype Component = any;\n\nexport interface Props {\n  View: typeof Backbone.View;\n  options?: object;\n  as?: string | Component;\n  instance?: Ref<Backbone.View>;\n}\n\nexport default memo(\n  forwardRef(function BackboneView(props: Props, ref: Ref<any>) {\n    const {\n      View,\n      options = {},\n      as: Component = 'div',\n      instance: instanceRef,\n      ...passthrough\n    } = props;\n    const container = useRef<null | HTMLElement>(null);\n\n    // Need to use the container's ref, but also want to forward\n    const setContainerRef = (current: HTMLElement) => {\n      container.current = current;\n      setRef(ref, current);\n    };\n\n    // For mount:, create instance, append, and then render\n    // (render after appending to avoid issues with views that expect to be in the DOM)\n    //\n    // For update: not used here due to React.memo that doesn't change\n    //\n    // For unmount: remove the instance to allow for cleanup\n    useEffect(() => {\n      const instance = new View(options);\n\n      container.current!.appendChild(instance.el);\n      instance.render();\n\n      setRef(instanceRef, instance);\n\n      return () => {\n        instance.remove();\n      };\n    }, [container]);\n\n    return <Component {...passthrough} ref={setContainerRef} />;\n  }),\n\n  // The only way to interact with the Backbone view is imperatively via instance\n  alwaysEqual\n);\n\nfunction setRef<TValue>(ref: Ref<TValue> | undefined, value: TValue | null) {\n  if (!ref) return;\n\n  if (isFunction(ref)) {\n    (ref as RefFunction<TValue>)(value);\n  } else {\n    // @ts-ignore Cannot assign to 'current' because it is a read-only property\n    // https://github.com/DefinitelyTyped/DefinitelyTyped/issues/31065\n    (ref as RefObject<TValue>).current = value;\n  }\n}\n\nfunction alwaysEqual() {\n  return true;\n}\n","import * as Backbone from 'backbone';\nimport * as React from 'react';\nimport { render } from 'react-dom';\n\nexport default class ReactView extends Backbone.View<Backbone.Model> {\n  Component: any;\n  props: object;\n\n  constructor(Component: any, props: object = {}, options: object = {}) {\n    super(options);\n\n    this.Component = Component;\n    this.props = props;\n  }\n\n  render() {\n    const { Component, props, el } = this;\n    render(<Component {...props} />, el);\n\n    return this;\n  }\n}\n","import * as Backbone from 'backbone';\nimport * as React from 'react';\nimport { pick } from './utils';\n\nexport default function useModel(model: Backbone.Model, keys?: string[]): any {\n  const select = () => {\n    return { ...(keys ? pick(model.attributes, keys) : model.attributes) };\n  };\n\n  const [attributes, setAttributes] = React.useState(select());\n  const event = keys ? keys.map(key => `change:${key}`).join(' ') : 'change';\n\n  React.useEffect(() => {\n    const onChange = () => {\n      setAttributes(select());\n    };\n    model.on(event, onChange);\n\n    return () => {\n      model.off(event, onChange);\n    };\n  }, [model]);\n\n  return attributes;\n}\n"],"names":["memo","forwardRef","useRef","useEffect","React","tslib_1.__extends","render","React.createElement","Backbone.View","React.useEffect"],"mappings":"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"}